<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Index</title>
	<link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../assets/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="../assets/css/navbar.css">
	
	<script type="text/javascript" src="../assets/js/json-formatter.js"></script>
	
	<script src="../assets/js/jquery-3.1.1.min.js"></script>
	<script src="../assets/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="../font-awesome-4.7.0/css/font-awesome.min.css">

	<script src="../d3/d3.js" charset="utf-8"></script>
	<!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	<!--<script type="text/javascript" src="elements.js"></script>-->
	<!--<script type="text/javascript" src="responseHandling.js"></script>-->
	<script type="text/javascript" src="helper.js"></script>
	<script type="text/javascript" src="activityList.js"></script>
	<script type="text/javascript" src="patient.js"></script>

	<style>
	</style>
	
</head>
<body>

	<nav class="navbar navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">CarePlan Viewer</a>
			</div>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-3 col-md-2 sidebar navbar-inverse" style="display:flex;flex-direction:column;">
				<ul class="nav nav-sidebar">
					<li class="active">
						<a href="#">Care Plan Centric</a>
					</li>
					<li>
						<a href="#" style="color: rgb(255,255,255)">Patient Centric</a>
					</li>
				</ul>
				<ul class="nav nav-sidebar">
					<li>
						<a href="#" style="color: rgb(255,255,255)">Calendar Centric</a>
					</li>
				</ul>
				<div id="patientInfo" style="margin-top:auto;">
					<div class="row" style="padding-right:20px;">
						<div class="col-sm-9">
							<label id="name" style="font-size:20px;color:white;padding-bottom:5px;">Patient Name</label>
						</div>
					<!-- Trigger the modal with a button -->
						<div class="col-sm-3">
							<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#patientSelect" style="height:35px;font-size:15px;">
								<span class="fa fa-random fa-inverse" style="font-size:15px;"></span>
							</button><br>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-2">
							<span class="fa fa-gift fa-inverse fa-normal"></span>
						</div>
						<div class="col-sm-10">
							<p id="birthdate" style="color:white;"></p>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-2">
							<span class="fa fa-venus-mars fa-inverse fa-normal"></span>
						</div>
						<div class="col-sm-10">
							<p id="gender" style="color:white;"></p>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-2">
							<span class="fa fa-phone fa-inverse fa-normal"></span>
						</div>
						<div class="col-sm-10">
							<p id="phone" style="color:white;"></p>
						</div>
					</div>
				</div>
				
			</div>
			<div class="col-sm-9 coll-sm-offset-3 col-md-10 col-md-offset-2 main" id="content">

				<div class="alert alert-danger" id='error-alert-content' style="display: none;"></div>
				<div class="alert alert-info" id="res">Please choose a Patient.</div>

				<div class='box' id='hover' style="display:none;"></div>

			</div>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div id="patientSelect" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Select Patient</h4>
				</div>
				<div class="modal-body">
					<div id="selectionForm" name="selectionForm" method="POST">
						<select class="form-control attributeSelect" id="attributeSelect_1" name="attributeSelect_1" data-attr="1">
							<option>Patient 1</option>
						</select>
						<button id="submit" type="submit" class="btn btn-default">Submit</button>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				</div>
			</div>

		</div>
	</div>


	<script>

		var gLoggedUser = "Practitioner/29223"; //format: Patient/234643 or Practitioner/316480
        var gCareplans = null, gPatient = null, gPerformer = [];

        function init(){
            //TODO clicked action from other page
            if(gCareplans == null || gPatient == null){
                $('#patientSelect').modal('toggle');
			}else{
                makeList(gCareplans, clicked);
                displayPatientInfo(gPatient);
			}
		}

        $(document).ready(function(){

            init();


            $('#submit').on('click', function() {
				$('#careplanMap').remove();
                gCareplans = null;
                gPatient = null;
                gPerformer = [];
                $('#patientSelect').modal('toggle');
                $("#error-alert-content").fadeOut();
                $('#error-alert-content').html('');
                var $button = $(this);
                $button.button('loading');

				//var newUrl = "http://fhirtest.uhn.ca/baseDstu3/CarePlan?subject=5024";
				//var newUrl = "http://localhost/jsonExamples/largeCareplan.json";
				var newUrl = "http://localhost/jsonExamples/manyCareplans.json";

                $.ajax({
                    url: 'scriptUrl.php',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {
                        "data": newUrl
                    },
                    success: function (response) {
                        $button.button('reset');
                        //Error Handling
                        if (typeof response.result.issue !== 'undefined') {
                            console.log(response);
                            if(response.result.issue["0"].severity === "error") {
                                $('#error-alert-content').append(response.result.issue["0"].diagnostics);
                                $("#error-alert-content").fadeIn();
                            }
                        }else {
                            $('#res').hide();
                            console.log(response);

                            if ("entry" in response['result']) {
                                makeList(response['result']['entry'], null);
                                gCareplans = response['result']['entry'];
                            } else {
                                $('#res').html("No results found for this query.");
                                $('#res').fadeIn();
                            }
                        }

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        $button.button('reset');
                        alert(xhr.status + " " + thrownError);
                        moreToSearch = false;
                    }
                });

                newUrl = "http://fhirtest.uhn.ca/baseDstu3/Patient?_id=5024";
                $.ajax({
                    url: 'scriptUrl.php',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {
                        "data": newUrl
                    },
                    success: function (response) {
                        $button.button('reset');
                        //Error Handling
                        if (typeof response.result.issue !== 'undefined') {
                            console.log(response);
                            if(response.result.issue["0"].severity === "error") {
                                $('#error-alert-content').append(response.result.issue["0"].diagnostics);
                                $("#error-alert-content").fadeIn();
                            }
                        }else {
                            $('#res').hide();
                            console.log(response);

                            if ("entry" in response['result']) {
                                gPatient = response['result']['entry'][0]['resource'];
								displayPatientInfo(response['result']['entry'][0]['resource']);
                            } else {
                                $('#res').html("No patient info found for this query.");
                                $('#res').fadeIn();
                            }
                        }

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        $button.button('reset');
                        alert(xhr.status + " " + thrownError);
                        moreToSearch = false;
                    }
                });
            });

            $('#content').on("click",".icon", function(){
                //TODO
				console.log("click");
			});

		});
	</script>


</body>
</html>